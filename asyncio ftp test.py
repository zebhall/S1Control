import asyncio

XRF_FTP_IP = '192.168.137.139'
XRF_FTP_PORT = 55000

async def send_command(reader, writer, command_hex):
    print("Sending command: " + str(command_hex))
    writer.write(command_hex)
    await writer.drain()
    response_hex = await reader.read(1024)
    return response_hex

async def main():

    server_address = (XRF_FTP_IP, XRF_FTP_PORT)
    weird_blank_deadfeed_packet = b"\x00\x00\x00\x00\xed\xfe\xad\xde\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    get_cmd_file = b"\x24\x4f\x57\x20\x32\x31\x2c\x20\x42\x72\x75\x6b\x65\x72\x43\x6f\x6d\x6d\x61\x6e\x64\x46\x69\x6c\x65\x2e\x43\x4d\x44\x0d"
    get_file_list_root = b"\x24\x46\x57\x20\x31\x36\x2c\x20\x3a\x0d\x47\x65\x74\x46\x69\x6c\x65\x4c\x69\x73\x74\x20\x5c\x2a\x2e\x2a"    # $FW 16, :GetFileList \*.*
    get_file_status_geoexpl_aen = b"\x24\x46\x57\x20\x34\x30\x2c\x20\xd9\x0d\x47\x65\x74\x46\x69\x6c\x65\x53\x74\x61\x74\x75\x73\x20\x5c\x42\x52\x55\x4b\x45\x52\x5c\x47\x65\x6f\x45\x78\x70\x6c\x6f\x72\x61\x74\x69\x6f\x6e\x2e\x61\x65\x6e"
        
    commands_hex = [weird_blank_deadfeed_packet, get_cmd_file, get_file_list_root, get_file_status_geoexpl_aen]

    reader, writer = await asyncio.open_connection(*server_address)
    
    for command_hex in commands_hex:
        response_hex = await send_command(reader, writer, command_hex)
        print(f"Response for {command_hex.hex()}: {response_hex.hex()}")
        
    writer.close()
    await writer.wait_closed()

if __name__ == "__main__":
    asyncio.run(main())