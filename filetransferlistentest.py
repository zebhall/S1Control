import socket
import time
import os

def instrument_Connect(xrf):
    ping = os.system('ping -n 1 -w 40 '+XRF_IP_USB)
    #print(f'ping = {ping}')
    if ping != 0:
        connection_attempt_count = 0
        while ping != 0:       # ping will only equal 0 if there are no errors or timeouts
            ping = os.system('ping -n 1 -w 40 '+XRF_IP_USB)
            time.sleep(0.1)
            print(f'ping = {ping}')
            connection_attempt_count += 1
            if connection_attempt_count >= 5:
                raise SystemExit(0)

    xrf.connect((XRF_IP_USB, XRF_PORT_USB))


def recvChunks(s, expected_len):
    chunks = []
    recv_len = 0
    while recv_len < expected_len:
        chunk = s.recv(expected_len-recv_len)
        if chunk == b'':
            raise Exception("XRF Socket connection broken")
        chunks.append(chunk)
        recv_len = recv_len + len(chunk)
    return b''.join(chunks)

def recvData(s):
    header = recvChunks(s, 10)
    data_size = int.from_bytes(header[6:10], 'little')
    data = recvChunks(s, data_size)
    footer = recvChunks(s, 4)

    return header, data_size, data, footer


# CONNECTION DETAILS FOR TCP/IP VIA USB (Recommended)
XRF_IP_USB = '192.168.137.139'
XRF_PORT_USB = 55205    #55204

# CONNECTION DETAILS FOR WIFI  (Not Recommended - Also, DHCP will cause IP to change. Port may change as well?) Wifi is unreliable and prone to massive packet loss and delayed commands/info transmit.
XRF_IP_WIFI = '192.168.153.167'   # '192.168.153.167:55101' found to work for ruffo when on phone hotspot network. both values may change depending on network settings?
XRF_PORT_WIFI = 55101

XRF_IP_USB_ALTERNATE = '190.168.137.139' # In some VERY UNUSUAL cases, I have seen instuments come back from Bruker servicing with this IP changed to 190 instead of 192. Worth checking if it breaks.





# xrf =  socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# instrument_Connect(xrf)
# header, data_size, data, footer = recvData(xrf)
# print(f'header = {header}')
# print(f'data_size = {data_size}')
# print(f'data = {data}')
# print(f'footer = {footer}')


data = b"\x00\x00\xad\x00\x00\x00\x02\x00\xad\x00\x00\x00\x08\x00\x45\x00" \
"\x05\xdc\x07\x72\x40\x00\x80\x06\x59\x9e\xc0\xa8\x89\x8b\xc0\xa8" \
"\x89\x2f\xd6\xd8\xdc\x33\x02\xd5\x2c\x61\x81\x2e\xa5\xbf\x50\x10" \
"\x7f\x68\x3e\x07\x00\x00\x00\x00\x00\x2b\x00\x00\x00\x2c\x00\x00" \
"\x00\x30\x00\x00\x00\x47\x00\x00\x00\x3d\x00\x00\x00\x33\x00\x00" \
"\x00\x3b\x00\x00\x00\x33\x00\x00\x00\x39\x00\x00\x00\x3e\x00\x00" \
"\x00\x40\x00\x00\x00\x40\x00\x00\x00\x44\x00\x00\x00\x3b\x00\x00" \
"\x00\x3d\x00\x00\x00\x3e\x00\x00\x00\x37\x00\x00\x00\x33\x00\x00" \
"\x00\x3d\x00\x00\x00\x3b\x00\x00\x00\x41\x00\x00\x00\x47\x00\x00" \
"\x00\x39\x00\x00\x00\x3e\x00\x00\x00\x36\x00\x00\x00\x41\x00\x00" \
"\x00\x34\x00\x00\x00\x2b\x00\x00\x00\x42\x00\x00\x00\x36\x00\x00" \
"\x00\x40\x00\x00\x00\x2b\x00\x00\x00\x38\x00\x00\x00\x3a\x00\x00" \
"\x00\x39\x00\x00\x00\x33\x00\x00\x00\x3d\x00\x00\x00\x3e\x00\x00" \
"\x00\x49\x00\x00\x00\x39\x00\x00\x00\x38\x00\x00\x00\x3c\x00\x00" \
"\x00\x3a\x00\x00\x00\x45\x00\x00\x00\x3c\x00\x00\x00\x3b\x00\x00" \
"\x00\x30\x00\x00\x00\x39\x00\x00\x00\x2e\x00\x00\x00\x32\x00\x00" \
"\x00\x3a\x00\x00\x00\x31\x00\x00\x00\x2b\x00\x00\x00\x3b\x00\x00" \
"\x00\x3b\x00\x00\x00\x30\x00\x00\x00\x3b\x00\x00\x00\x49\x00\x00" \
"\x00\x38\x00\x00\x00\x38\x00\x00\x00\x33\x00\x00\x00\x3c\x00\x00" \
"\x00\x38\x00\x00\x00\x37\x00\x00\x00\x3f\x00\x00\x00\x3b\x00\x00" \
"\x00\x30\x00\x00\x00\x2d\x00\x00\x00\x33\x00\x00\x00\x37\x00\x00" \
"\x00\x36\x00\x00\x00\x3e\x00\x00\x00\x37\x00\x00\x00\x36\x00\x00" \
"\x00\x3b\x00\x00\x00\x3a\x00\x00\x00\x40\x00\x00\x00\x3e\x00\x00" \
"\x00\x34\x00\x00\x00\x3b\x00\x00\x00\x44\x00\x00\x00\x39\x00\x00" \
"\x00\x3b\x00\x00\x00\x41\x00\x00\x00\x47\x00\x00\x00\x39\x00\x00" \
"\x00\x45\x00\x00\x00\x41\x00\x00\x00\x3e\x00\x00\x00\x30\x00\x00" \
"\x00\x37\x00\x00\x00\x3f\x00\x00\x00\x2b\x00\x00\x00\x49\x00\x00" \
"\x00\x34\x00\x00\x00\x34\x00\x00\x00\x3f\x00\x00\x00\x2c\x00\x00" \
"\x00\x39\x00\x00\x00\x38\x00\x00\x00\x34\x00\x00\x00\x33\x00\x00" \
"\x00\x39\x00\x00\x00\x35\x00\x00\x00\x42\x00\x00\x00\x39\x00\x00" \
"\x00\x39\x00\x00\x00\x3e\x00\x00\x00\x3b\x00\x00\x00\x2c\x00\x00" \
"\x00\x3b\x00\x00\x00\x42\x00\x00\x00\x41\x00\x00\x00\x3b\x00\x00" \
"\x00\x46\x00\x00\x00\x31\x00\x00\x00\x3f\x00\x00\x00\x37\x00\x00" \
"\x00\x3c\x00\x00\x00\x48\x00\x00\x00\x33\x00\x00\x00\x35\x00\x00" \
"\x00\x2c\x00\x00\x00\x3d\x00\x00\x00\x3a\x00\x00\x00\x34\x00\x00" \
"\x00\x3f\x00\x00\x00\x46\x00\x00\x00\x37\x00\x00\x00\x3c\x00\x00" \
"\x00\x35\x00\x00\x00\x31\x00\x00\x00\x3b\x00\x00\x00\x35\x00\x00" \
"\x00\x48\x00\x00\x00\x30\x00\x00\x00\x32\x00\x00\x00\x36\x00\x00" \
"\x00\x33\x00\x00\x00\x34\x00\x00\x00\x2d\x00\x00\x00\x3c\x00\x00" \
"\x00\x37\x00\x00\x00\x43\x00\x00\x00\x3f\x00\x00\x00\x39\x00\x00" \
"\x00\x37\x00\x00\x00\x36\x00\x00\x00\x4c\x00\x00\x00\x25\x00\x00" \
"\x00\x41\x00\x00\x00\x35\x00\x00\x00\x44\x00\x00\x00\x47\x00\x00" \
"\x00\x40\x00\x00\x00\x3b\x00\x00\x00\x41\x00\x00\x00\x35\x00\x00" \
"\x00\x37\x00\x00\x00\x37\x00\x00\x00\x39\x00\x00\x00\x46\x00\x00" \
"\x00\x43\x00\x00\x00\x2f\x00\x00\x00\x31\x00\x00\x00\x34\x00\x00" \
"\x00\x42\x00\x00\x00\x3d\x00\x00\x00\x2c\x00\x00\x00\x38\x00\x00" \
"\x00\x3a\x00\x00\x00\x48\x00\x00\x00\x39\x00\x00\x00\x39\x00\x00" \
"\x00\x3a\x00\x00\x00\x34\x00\x00\x00\x31\x00\x00\x00\x29\x00\x00" \
"\x00\x2d\x00\x00\x00\x46\x00\x00\x00\x35\x00\x00\x00\x38\x00\x00" \
"\x00\x35\x00\x00\x00\x32\x00\x00\x00\x38\x00\x00\x00\x46\x00\x00" \
"\x00\x32\x00\x00\x00\x34\x00\x00\x00\x41\x00\x00\x00\x32\x00\x00" \
"\x00\x38\x00\x00\x00\x41\x00\x00\x00\x40\x00\x00\x00\x3b\x00\x00" \
"\x00\x3b\x00\x00\x00\x3b\x00\x00\x00\x3c\x00\x00\x00\x35\x00\x00" \
"\x00\x35\x00\x00\x00\x40\x00\x00\x00\x33\x00\x00\x00\x33\x00\x00" \
"\x00\x3e\x00\x00\x00\x2a\x00\x00\x00\x40\x00\x00\x00\x39\x00\x00" \
"\x00\x3c\x00\x00\x00\x3b\x00\x00\x00\x46\x00\x00\x00\x32\x00\x00" \
"\x00\x35\x00\x00\x00\x33\x00\x00\x00\x33\x00\x00\x00\x33\x00\x00" \
"\x00\x2b\x00\x00\x00\x34\x00\x00\x00\x44\x00\x00\x00\x3c\x00\x00" \
"\x00\x43\x00\x00\x00\x3d\x00\x00\x00\x33\x00\x00\x00\x34\x00\x00" \
"\x00\x40\x00\x00\x00\x2b\x00\x00\x00\x30\x00\x00\x00\x33\x00\x00" \
"\x00\x3a\x00\x00\x00\x2b\x00\x00\x00\x4a\x00\x00\x00\x3c\x00\x00" \
"\x00\x2c\x00\x00\x00\x3b\x00\x00\x00\x3d\x00\x00\x00\x2d\x00\x00" \
"\x00\x37\x00\x00\x00\x44\x00\x00\x00\x3f\x00\x00\x00\x2e\x00\x00" \
"\x00\x2f\x00\x00\x00\x37\x00\x00\x00\x41\x00\x00\x00\x43\x00\x00" \
"\x00\x28\x00\x00\x00\x36\x00\x00\x00\x37\x00\x00\x00\x37\x00\x00" \
"\x00\x3b\x00\x00\x00\x30\x00\x00\x00\x32\x00\x00\x00\x3b\x00\x00" \
"\x00\x3f\x00\x00\x00\x3e\x00\x00\x00\x35\x00\x00\x00\x25\x00\x00" \
"\x00\x38\x00\x00\x00\x32\x00\x00\x00\x47\x00\x00\x00\x2c\x00\x00" \
"\x00\x3a\x00\x00\x00\x37\x00\x00\x00\x2c\x00\x00\x00\x35\x00\x00" \
"\x00\x36\x00\x00\x00\x3c\x00\x00\x00\x36\x00\x00\x00\x32\x00\x00" \
"\x00\x3c\x00\x00\x00\x36\x00\x00\x00\x41\x00\x00\x00\x32\x00\x00" \
"\x00\x39\x00\x00\x00\x36\x00\x00\x00\x2c\x00\x00\x00\x32\x00\x00" \
"\x00\x3e\x00\x00\x00\x2d\x00\x00\x00\x37\x00\x00\x00\x3d\x00\x00" \
"\x00\x3a\x00\x00\x00\x2f\x00\x00\x00\x36\x00\x00\x00\x37\x00\x00" \
"\x00\x3b\x00\x00\x00\x36\x00\x00\x00\x3b\x00\x00\x00\x30\x00\x00" \
"\x00\x29\x00\x00\x00\x34\x00\x00\x00\x35\x00\x00\x00\x32\x00\x00" \
"\x00\x32\x00\x00\x00\x30\x00\x00\x00\x33\x00\x00\x00\x42\x00\x00" \
"\x00\x39\x00\x00\x00\x39\x00\x00\x00\x36\x00\x00\x00\x2d\x00\x00" \
"\x00\x45\x00\x00\x00\x31\x00\x00\x00\x33\x00\x00\x00\x2d\x00\x00" \
"\x00\x37\x00\x00\x00\x2a\x00\x00\x00\x30\x00\x00\x00\x46\x00\x00" \
"\x00\x36\x00\x00\x00\x43\x00\x00\x00\x36\x00\x00\x00\x3b\x00\x00" \
"\x00\x33\x00\x00\x00\x2e\x00\x00\x00\x46\x00\x00\x00\x33\x00\x00" \
"\x00\x34\x00\x00\x00\x3b\x00\x00\x00\x2e\x00\x00\x00\x27\x00\x00" \
"\x00\x2c\x00\x00\x00\x41\x00\x00\x00\x39\x00\x00\x00\x30\x00\x00" \
"\x00\x33\x00\x00\x00\x3c\x00\x00\x00\x45\x00\x00\x00\x2d\x00\x00" \
"\x00\x29\x00\x00\x00\x36\x00\x00\x00\x33\x00\x00\x00\x30\x00\x00" \
"\x00\x33\x00\x00\x00\x3c\x00\x00\x00\x31\x00\x00\x00\x2a\x00\x00" \
"\x00\x3b\x00\x00\x00\x3f\x00\x00\x00\x3c\x00\x00\x00\x31\x00\x00" \
"\x00\x31\x00\x00\x00\x3f\x00\x00\x00\x34\x00\x00\x00\x2b\x00\x00" \
"\x00\x3a\x00\x00\x00\x2b\x00\x00\x00\x35\x00\x00\x00\x33\x00\x00" \
"\x00\x2e\x00\x00\x00\x29\x00\x00\x00\x2e\x00\x00\x00\x3e\x00\x00" \
"\x00\x2a\x00\x00\x00\x2e\x00\x00\x00\x2b\x00\x00\x00\x38\x00\x00" \
"\x00\x2f\x00\x00\x00\x3b\x00\x00\x00\x3d\x00\x00\x00\x34\x00\x00" \
"\x00\x35\x00\x00\x00\x31\x00\x00\x00\x3a\x00\x00\x00\x2b\x00\x00"




print(data)

